-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- UI Setup
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "UniversalHub"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 200, 0, 200)
frame.Position = UDim2.new(0, 20, 0.5, -100)
frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
frame.BackgroundTransparency = 0.4
frame.BorderSizePixel = 0

-- Utility: Create Buttons
local function createButton(name, yPos, callback)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(0, 180, 0, 40)
	btn.Position = UDim2.new(0, 10, 0, yPos)
	btn.BackgroundColor3 = Color3.fromRGB(10, 10, 8)
	btn.TextColor3 = Color3.fromRGB(0, 0, 0)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 20
	btn.Text = name
	btn.MouseButton1Click:Connect(callback)
	return btn
end

-- State Flags
local espOn = false
local attackOn = false
local aimOn = false
local espObjects = {}

-- ESP Function
local function createESP(player)
	local box = Drawing.new("Text")
	box.Text = player.Name
	box.Size = 15
	box.Color = Color3.fromRGB(255, 255, 255)
	box.Center = true
	box.Outline = true
	box.Visible = false
	espObjects[player] = box
end

local function removeESP(player)
	if espObjects[player] then
		espObjects[player]:Remove()
		espObjects[player] = nil
	end
end

-- ESP Toggle
local function toggleESP()
	espOn = not espOn
	if espOn then
		for _, plr in ipairs(Players:GetPlayers()) do
			if plr ~= LocalPlayer then createESP(plr) end
		end
		Players.PlayerAdded:Connect(function(plr)
			if espOn and plr ~= LocalPlayer then createESP(plr) end
		end)
		Players.PlayerRemoving:Connect(function(plr)
			removeESP(plr)
		end)
		print("ESP On")
	else
		for _, box in pairs(espObjects) do box:Remove() end
		espObjects = {}
		print("ESP Off")
	end
end

-- Fast Attack Function
local function toggleAttack()
	attackOn = not attackOn
	print("Fast Attack: ", attackOn)
end

-- Silent Aim Placeholder
local function toggleAim()
	aimOn = not aimOn
	print("Silent Aim: ", aimOn)
end

-- UI Buttons
createButton("Toggle ESP", 10, toggleESP)
createButton("Toggle Fast Attack", 60, toggleAttack)
createButton("Toggle Silent Aim", 110, toggleAim)

-- Update ESP Positions
RunService.RenderStepped:Connect(function()
	if espOn then
		for player, textObj in pairs(espObjects) do
			if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
				local hrp = player.Character.HumanoidRootPart
				local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrp.Position)
				if onScreen then
					textObj.Position = Vector2.new(screenPos.X, screenPos.Y - 30)
					textObj.Visible = true
				else
					textObj.Visible = false
				end
			else
				textObj.Visible = false
			end
		end
	end
end)

-- Fast Attack Loop
task.spawn(function()
	while true do
		task.wait(0.05)
		if attackOn then
			local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
			if tool then
				tool:Activate()
			end
		end
	end
end)
